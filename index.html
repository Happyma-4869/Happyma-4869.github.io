<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy çš„ä¸ªäººä¸»é¡µ â€” åœ£è¯å‡çº§ç‰ˆ</title>
<style>
/* ---------- åŸºç¡€æ ·å¼ ---------- */
:root{--card-w:320px;}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;background:#0f1720;color:#222;transition:color .3s;background-attachment:fixed;}
body.dark{background:#0b0b0d;color:#eee}

/* èƒŒæ™¯è§†é¢‘ & ç²’å­ */
#bgVideo{position:fixed;left:0;top:0;width:100%;height:100%;object-fit:cover;z-index:0;transition:filter .4s}
body.dark #bgVideo{filter:brightness(.38) contrast(1.05)}
#particles{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:1}

/* ---------- 3D åœ£è¯æ ‘å¡ç‰‡ï¼ˆå·¦ä¾§ï¼‰ ---------- */
#treeCard{
  position:fixed;
  left:20px;
  top:50%;
  transform:translateY(-50%);
  width:400px;
  height:600px;
  border-radius:24px;
  background:rgba(255,255,255,0.06);
  box-shadow:0 12px 40px rgba(2,6,23,0.6);
  backdrop-filter:blur(8px);
  overflow:hidden;
  z-index:3;           /* æ¯”ç²’å­ä¸è§†é¢‘é«˜ */
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
#treeCard.hideOnMobile{display:block}
#treeCanvas{width:100%;height:100%;display:block;}

/* é¡µé¢å†…å®¹å‘å³ç§»ä»¥é¿å¼€æ ‘ï¼ˆæ¡Œé¢ï¼‰ */
.mainContent{
  position:relative;
  z-index:2;
  margin-left:460px; /* ç•™å‡ºç©ºé—´ç»™å·¦ä¾§æ ‘ */
  padding-bottom:60px;
  min-height:100vh;
}
/* ç§»åŠ¨ç«¯æ”¶èµ·æ ‘å¹¶æ¢å¤å¸ƒå±€ */
@media(max-width:900px){
  #treeCard{display:none}
  .mainContent{margin-left:0}
}

/* ---------- å¤´éƒ¨ä¸å¯¼èˆª ---------- */
header{text-align:center;padding:44px 20px 8px}
header img{width:120px;height:120px;border-radius:50%;border:3px solid rgba(255,255,255,.08);display:block;margin:0 auto 12px;object-fit:cover}
h1{margin:6px 0;font-size:28px;color:inherit}
p.lead{margin:6px 0;color:rgba(255,255,255,.7);font-size:14px}

/* å¸é¡¶å¯¼èˆª */
nav{position:sticky;top:12px;margin:14px auto 0;background:rgba(255,255,255,.02);padding:8px;border-radius:14px;width:fit-content;z-index:20}
nav a{margin:0 12px;color:inherit;text-decoration:none;font-weight:600}

/* æ—¥å¤œåˆ‡æ¢ & è¿”å›é¡¶éƒ¨ */
#modeToggle{position:fixed;right:20px;top:20px;z-index:21;padding:8px 14px;border-radius:20px;background:linear-gradient(135deg,#5ac8fa,#007aff);color:white;cursor:pointer}
#toTopBtn{position:fixed;right:20px;bottom:22px;z-index:21;padding:10px 14px;border-radius:24px;background:linear-gradient(135deg,#5ac8fa,#007aff);color:#fff;border:none;cursor:pointer;display:none}

/* ---------- å¡ç‰‡ / about / tags ---------- */
section{padding:56px 18px; text-align:center}
.card{width:var(--card-w);margin:0 auto 22px;padding:18px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));backdrop-filter:blur(10px);box-shadow:0 10px 30px rgba(2,6,23,0.6);color:inherit}
.card .tags{margin-top:8px}
.tag{display:inline-block;padding:6px 10px;border-radius:12px;margin:4px;background:linear-gradient(45deg,#5ac8fa,#007aff);color:#fff;font-size:13px}

/* ---------- æ—¥è®°åŒºåŸŸï¼ˆå°å·§å±…ä¸­è¾“å…¥ï¼‰ ---------- */
#diary .card{width:360px;padding:14px}
input[type="date"],textarea{width:80%;padding:8px;border-radius:12px;border:none;margin:6px auto;display:block;background:rgba(0,0,0,0.25);color:inherit}
#addDiaryBtn{display:inline-block;padding:10px 16px;border-radius:20px;background:linear-gradient(135deg,#3db0ff,#006ee6);color:#fff;border:none;font-weight:700;font-size:15px;cursor:pointer}
.diary-actions button{padding:6px 10px;border-radius:16px;background:rgba(255,255,255,0.06);border:none;color:inherit;cursor:pointer;margin-left:6px;font-size:13px}

/* æ—¥è®°å¡ç‰‡å†…æŒ‰é’®åˆ†ç»„ */
.diary-entry .diary-actions{display:flex;justify-content:center;margin-top:10px}

/* è”ç³»åŒºåŸŸï¼ˆäºŒç»´ç ï¼‰ */
.contact .qr img{width:140px;height:140px;border-radius:18px;cursor:pointer}

/* å°å±é€‚é…ï¼šç¼©å°ä¸€äº›å¡ç‰‡ */
@media(max-width:480px){
  #addDiaryBtn{padding:8px 12px;font-size:14px}
  .card{width:92%}
}

/* å¸®åŠ©ç±»ï¼ˆéšè—æ’­æ”¾æŒ‰é”®ç­‰ï¼‰ */
.hidden{display:none}
</style>
</head>
<body>

<!-- èƒŒæ™¯ è§†é¢‘ ä¸ å…¨å±€ç²’å­ç”»å¸ƒ -->
<video id="bgVideo" autoplay muted loop playsinline>
  <source src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/Video%20Project%204.mp4?raw=true" type="video/mp4">
</video>
<canvas id="particles"></canvas>

<!-- å·¦ä¾§ 3D åœ£è¯æ ‘å¡ç‰‡ï¼ˆfixedï¼‰ -->
<div id="treeCard" aria-hidden="false" title="ç‚¹å‡»å¯ä»¥ç‚¹äº®/æ”¾å¤§åœ£è¯æ ‘">
  <!-- three.js æ¸²æŸ“æ”¾è¿™é‡Œ -->
  <canvas id="treeCanvas"></canvas>
</div>

<!-- é¡µé¢ä¸»å†…å®¹ï¼ˆå³ç§»ä»¥é¿å¼€æ ‘ï¼‰ -->
<div class="mainContent">
  <header>
    <img src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20251207233412_9_79.jpg?raw=true" alt="å¤´åƒ">
    <h1>æ¬¢è¿æ¥åˆ° Happy çš„ä¸»é¡µ</h1>
    <p class="lead">è®°å½•æˆ‘çš„æ—¥å¸¸å’Œç‚¹æ»´ ğŸ˜Š</p>
    <nav id="mainNav">
      <a href="#about">å…³äºæˆ‘</a>
      <a href="#diary">æ—¥è®°</a>
      <a href="#contact">è”ç³»æˆ‘</a>
    </nav>
  </header>

  <div id="modeToggle">ğŸŒ™ æ—¥/å¤œåˆ‡æ¢</div>
  <button id="toTopBtn">â¬†ï¸ é¡¶éƒ¨</button>

  <section id="about">
    <h2>å…³äºæˆ‘</h2>
    <div class="card">
      <p>Hi æˆ‘æ˜¯happy  æˆ‘æ¥è‡ªæ²³å—éƒ‘å·å¸‚  ç›®å‰æ˜¯éƒ‘å·å¸‚è¥¿äºšæ–¯å¤§ä¸€å­¦ç”Ÿ  åœ¨æ­¤æˆ‘æƒ³åˆ†äº«æˆ‘çš„ç”Ÿæ´»</p>
      <div class="tags">
        <span class="tag">å­¦ä¹ </span><span class="tag">æ¸¸æˆ</span><span class="tag">éŸ³ä¹</span><span class="tag">ç¼–ç¨‹</span>
      </div>
    </div>
  </section>

  <section id="diary">
    <h2>æˆ‘çš„æ—¥è®° ğŸ“–</h2>
    <div class="card">
      <input id="diaryDate" type="date" />
      <textarea id="diaryContent" rows="3" placeholder="å†™ä¸‹ä»Šå¤©çš„æ—¥è®°..."></textarea>
      <div style="text-align:center;margin-top:6px">
        <button id="addDiaryBtn">æ·»åŠ æ—¥è®°</button>
      </div>
    </div>
    <div id="diaryList"></div>
  </section>

  <section id="contact">
    <h2>è”ç³»æˆ‘</h2>
    <p>å¾®ä¿¡ï¼š<strong>H4ppy_ma</strong></p>
    <div class="card contact">
      <div class="qr">
        <img id="qrImg" src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20251207233522_10_79.jpg?raw=true" alt="å¾®ä¿¡äºŒç»´ç ">
      </div>
    </div>
  </section>

  <footer style="text-align:center;padding:18px;color:rgba(255,255,255,0.45)">&copy; 2025 Happyma.top</footer>

  <div id="qrModal" class="hidden" style="position:fixed;left:0;top:0;width:100%;height:100%;z-index:50;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6)">
    <img src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20251207233522_10_79.jpg?raw=true" alt="äºŒç»´ç å¤§å›¾" style="max-width:320px;border-radius:16px;border:4px solid rgba(255,255,255,0.12)">
  </div>
</div>

<!-- three.js -->
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>

<script>
/* ===========================
   æ—¥è®° / UI / ç²’å­ èƒŒæ™¯é€»è¾‘
   =========================== */
const diaryList = document.getElementById('diaryList');
const addDiaryBtn = document.getElementById('addDiaryBtn');
const diaryDate = document.getElementById('diaryDate');
const diaryContent = document.getElementById('diaryContent');
const qrImg = document.getElementById('qrImg');
const qrModal = document.getElementById('qrModal');

let diaries = JSON.parse(localStorage.getItem('diaries')) || [
  {date:'2025-12-08', content:'ä»Šå¤©æ˜¯æˆ‘åˆæ¬¡åˆ›å»ºæˆ‘çš„ä¸ªäººç½‘ç«™  ç›®å‰è¿˜åœ¨æµ‹è¯•ä¸­  ä»¥åæˆ‘ä¼šé€æ­¥å®Œå–„è€¶âœŒ'}
];

function renderDiaries(){
  diaryList.innerHTML = '';
  diaries.forEach((d,i)=>{
    const entry = document.createElement('div');
    entry.className = 'card diary-entry';
    entry.innerHTML = `<p><strong>${d.date}</strong></p>
                       <p style="white-space:pre-wrap">${d.content}</p>
                       <div class="diary-actions">
                         <button onclick="editDiary(${i})">ç¼–è¾‘</button>
                         <button onclick="deleteDiary(${i})">åˆ é™¤</button>
                       </div>`;
    diaryList.appendChild(entry);
  });
  localStorage.setItem('diaries', JSON.stringify(diaries));
}
renderDiaries();

addDiaryBtn.addEventListener('click', ()=>{
  const dateVal = diaryDate.value || new Date().toISOString().split('T')[0];
  const contentVal = diaryContent.value.trim();
  if(!contentVal){ alert('è¯·å¡«å†™å†…å®¹'); return; }
  diaries.unshift({date:dateVal, content:contentVal});
  diaryDate.value=''; diaryContent.value='';
  renderDiaries();
});
window.editDiary = function(i){
  const newText = prompt('ç¼–è¾‘æ—¥è®°ï¼š', diaries[i].content);
  if(newText === null) return;
  diaries[i].content = newText;
  renderDiaries();
};
window.deleteDiary = function(i){
  if(!confirm('ç¡®è®¤åˆ é™¤è¿™æ¡æ—¥è®°ï¼Ÿ')) return;
  diaries.splice(i,1);
  renderDiaries();
};

// QR modal
qrImg.addEventListener('click', ()=>{ qrModal.classList.remove('hidden'); });
qrModal.addEventListener('click', ()=>{ qrModal.classList.add('hidden'); });

// æ—¥å¤œåˆ‡æ¢
const modeToggle = document.getElementById('modeToggle');
modeToggle.addEventListener('click', ()=>{
  document.body.classList.toggle('dark');
  // é‡æ–°åˆå§‹åŒ–ç²’å­é¢œè‰²å¯†åº¦
  initParticles();
});

// è¿”å›é¡¶éƒ¨ & å¯¼èˆªé«˜äº®
const toTopBtn = document.getElementById('toTopBtn');
window.addEventListener('scroll', ()=>{
  toTopBtn.style.display = (window.scrollY > 200) ? 'block' : 'none';
  // nav highlight
  const navLinks = document.querySelectorAll('#mainNav a');
  navLinks.forEach(link=>{
    const s = document.querySelector(link.getAttribute('href'));
    if(!s) return;
    if(window.scrollY >= s.offsetTop - 80 && window.scrollY < s.offsetTop + s.offsetHeight){
      link.style.color = '#ffeb3b';
    } else link.style.color = '';
  });
});
toTopBtn.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}) );

/* ---------- èƒŒæ™¯ç²’å­ç”»å¸ƒï¼ˆcanvasï¼‰ ---------- */
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let particlesArray = [];
let mouse = {x:null,y:null};
function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });

class BGParticle {
  constructor(){
    this.reset();
  }
  reset(){
    this.x = Math.random()*canvas.width;
    this.y = Math.random()*canvas.height;
    this.r = Math.random()*2+1;
    this.angle = Math.random()*Math.PI*2;
    this.orbit = Math.random()*20+6;
    this.speed = 0.004 + Math.random()*0.008;
    this.color = document.body.classList.contains('dark') ? 'rgba(255,255,255,0.9)' : 'rgba(255,255,255,0.28)';
  }
  update(){
    this.angle += this.speed;
    this.x += Math.cos(this.angle)*0.2;
    this.y += Math.sin(this.angle)*0.2;
    // é¼ æ ‡ç‰µå¼•ï¼ˆè½»å¾®ï¼‰
    if(mouse.x && mouse.y){
      const dx = mouse.x - this.x, dy = mouse.y - this.y;
      const dist = Math.sqrt(dx*dx+dy*dy);
      if(dist < 120){
        this.x += dx*0.01;
        this.y += dy*0.01;
      }
    }
    if(this.x<0||this.x>canvas.width||this.y<0||this.y>canvas.height) this.reset();
  }
  draw(){ ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fill(); }
}

function initParticles(){
  particlesArray = [];
  const count = document.body.classList.contains('dark') ? 150 : 80;
  for(let i=0;i<count;i++) particlesArray.push(new BGParticle());
}
initParticles();

function animateParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particlesArray.forEach(p=>{ p.update(); p.draw(); });
  requestAnimationFrame(animateParticles);
}
animateParticles();

/* ===========================
   three.js 3D åœ£è¯æ ‘ï¼ˆå·¦ä¾§å°å¡ç‰‡ï¼‰
   - ç‚¹å‡»è£…é¥°ä¼šé—ªçƒ/ç‚¹äº®
   - æ»šåŠ¨æ—¶æ ‘å¾®åŠ¨
   - æœ‰å°å…‰ç‚¹ç²’å­
   =========================== */
const treeCanvas = document.getElementById('treeCanvas');
const treeCard = document.getElementById('treeCard');

let renderer, scene, camera, controls, treeGroup;
let sphereMesh, cubeMesh, starMesh;
let instanceCount = 450;
let dummy = new THREE.Object3D();
let clock = new THREE.Clock();
let raycaster = new THREE.Raycaster();
let mouseN = new THREE.Vector2();
let ornamentColors = {}; // å­˜ instanceId -> color (THREE.Color)

// åˆå§‹åŒ– three æ¸²æŸ“å™¨ä¸åœºæ™¯
function initTree3D(){
  const w = treeCard.clientWidth;
  const h = treeCard.clientHeight;

  renderer = new THREE.WebGLRenderer({canvas: treeCanvas, alpha:true, antialias:true});
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.setSize(w,h);
  renderer.setClearColor(0x000000, 0); // é€æ˜åº•

  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(50, w/h, 0.1, 2000);
  camera.position.set(0,24,80);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableZoom = false;
  controls.enablePan = false;
  controls.enableRotate = false; // åªç”¨ç¨‹åºæ—‹è½¬ï¼Œé¿å…ç”¨æˆ·å¹²æ‰°å¡ç‰‡ä½ç½®

  // lights
  const amb = new THREE.AmbientLight(0xffffff, 0.6); scene.add(amb);
  const dir = new THREE.DirectionalLight(0xffffff, 0.8); dir.position.set(30,80,40); scene.add(dir);

  // group
  treeGroup = new THREE.Group();
  scene.add(treeGroup);

  // geometry & materials
  const sphereGeo = new THREE.SphereGeometry(1.6, 12, 12);
  const cubeGeo = new THREE.BoxGeometry(2.2,2.2,2.2);
  const goldMat = new THREE.MeshStandardMaterial({color:0xFFD700, metalness:0.8, roughness:0.2});
  const greenMat = new THREE.MeshStandardMaterial({color:0x0b6a2d, metalness:0.4, roughness:0.6});

  // instanced meshes for ornaments
  sphereMesh = new THREE.InstancedMesh(sphereGeo, goldMat, instanceCount);
  cubeMesh = new THREE.InstancedMesh(cubeGeo, greenMat, instanceCount);
  sphereMesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage);
  cubeMesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage);
  if(sphereMesh.instanceColor) sphereMesh.instanceColor.setUsage(THREE.DynamicDrawUsage);
  if(cubeMesh.instanceColor) cubeMesh.instanceColor.setUsage(THREE.DynamicDrawUsage);

  treeGroup.add(sphereMesh);
  treeGroup.add(cubeMesh);

  // build tree silhouette by layering positions
  for(let i=0;i<instanceCount;i++){
    const layer = Math.floor(Math.random()*18); // layers from 0..17
    const y = layer * 1.6 - 10; // center roughly
    const radius = 1 + (18 - layer) * 1.2 + Math.random()*0.6;
    const angle = Math.random()*Math.PI*2;
    const x = Math.cos(angle) * radius;
    const z = Math.sin(angle) * radius * 0.8; // squash z for silhouette

    dummy.position.set(x, y, z);
    dummy.rotation.set(Math.random()*Math.PI, Math.random()*Math.PI, Math.random()*Math.PI);
    dummy.scale.setScalar(0.8 + Math.random()*0.9);
    dummy.updateMatrix();

    if(i % 2 === 0) {
      sphereMesh.setMatrixAt(i, dummy.matrix);
      // alternate colors
      if(Math.random() > 0.6) { sphereMesh.setColorAt(i, new THREE.Color(0xFF2B2B)); ornamentColors['s_'+i] = new THREE.Color(0xFF2B2B); }
      else { sphereMesh.setColorAt(i, new THREE.Color(0xFFD700)); ornamentColors['s_'+i] = new THREE.Color(0xFFD700); }
    } else {
      cubeMesh.setMatrixAt(i, dummy.matrix);
      if(Math.random() > 0.6) { cubeMesh.setColorAt(i, new THREE.Color(0xFFD700)); ornamentColors['c_'+i] = new THREE.Color(0xFFD700); }
      else { cubeMesh.setColorAt(i, new THREE.Color(0x00A86B)); ornamentColors['c_'+i] = new THREE.Color(0x00A86B); }
    }
  }
  sphereMesh.instanceMatrix.needsUpdate = true;
  cubeMesh.instanceMatrix.needsUpdate = true;
  if(sphereMesh.instanceColor) sphereMesh.instanceColor.needsUpdate = true;
  if(cubeMesh.instanceColor) cubeMesh.instanceColor.needsUpdate = true;

  // star
  const starGeo = new THREE.OctahedronGeometry(3.4);
  const starMat = new THREE.MeshStandardMaterial({color:0xFFF176, emissive:0xFFEE88, metalness:1, roughness:0.2});
  starMesh = new THREE.Mesh(starGeo, starMat);
  starMesh.position.set(0, 20, 0);
  treeGroup.add(starMesh);

  // tiny floating light particles around tree
  addTreeParticles();

  // respond to canvas size change
  window.addEventListener('resize', ()=> {
    const ww = treeCard.clientWidth, hh = treeCard.clientHeight;
    renderer.setSize(ww, hh);
    camera.aspect = ww / hh;
    camera.updateProjectionMatrix();
  });

  // pointer interactions
  renderer.domElement.addEventListener('pointermove', onPointerMove);
  renderer.domElement.addEventListener('pointerdown', onPointerDown);
}

// å°å…‰ç‚¹
let treeParticles = [];
function addTreeParticles(){
  const geo = new THREE.SphereGeometry(0.18,6,6);
  for(let i=0;i<60;i++){
    const mat = new THREE.MeshStandardMaterial({color:0xffffff, emissive:0xffffff, emissiveIntensity:0.8, transparent:true, opacity: 0.9});
    const m = new THREE.Mesh(geo, mat);
    m.position.set((Math.random()-0.5)*16, Math.random()*24-2, (Math.random()-0.5)*12);
    m.userData = { speed: 0.02 + Math.random()*0.02, baseY: m.position.y, phase: Math.random()*Math.PI*2 };
    treeParticles.push(m);
    scene.add(m);
  }
}

// pointer handlers
function onPointerMove(evt){
  const rect = renderer.domElement.getBoundingClientRect();
  mouseN.x = ((evt.clientX - rect.left) / rect.width) * 2 - 1;
  mouseN.y = -((evt.clientY - rect.top) / rect.height) * 2 + 1;
}

function onPointerDown(evt){
  // æ£€æµ‹ç‚¹å‡»åˆ°çš„ instancedMesh å®ä¾‹
  const rect = renderer.domElement.getBoundingClientRect();
  const x = ((evt.clientX - rect.left)/rect.width)*2 -1;
  const y = -((evt.clientY - rect.top)/rect.height)*2 +1;
  raycaster.setFromCamera(new THREE.Vector2(x,y), camera);

  // ä¼˜å…ˆæ£€æµ‹çƒä½“
  let intersects = raycaster.intersectObject(sphereMesh);
  if(intersects.length>0){
    const instId = intersects[0].instanceId;
    if(instId !== undefined){
      toggleOrnamentColor('s', instId);
      return;
    }
  }
  // å†æ£€æµ‹ç«‹æ–¹ä½“
  intersects = raycaster.intersectObject(cubeMesh);
  if(intersects.length>0){
    const instId = intersects[0].instanceId;
    if(instId !== undefined){
      toggleOrnamentColor('c', instId);
      return;
    }
  }
  // ç‚¹å‡»å¡ç‰‡æœ¬èº«ï¼šæ”¾å¤§ç¼©å°ï¼ˆè§†è§‰äº¤äº’ï¼‰
  toggleTreeScale();
}

let isTreeScaled = false;
function toggleTreeScale(){
  if(!isTreeScaled){
    treeCard.style.transform = 'translateY(-50%) scale(1.12)';
    isTreeScaled = true;
  } else {
    treeCard.style.transform = 'translateY(-50%) scale(1)';
    isTreeScaled = false;
  }
}

// åˆ‡æ¢æŸä¸ªè£…é¥°é¢œè‰²ä¸ºé«˜äº®å‘å…‰æˆ–æ¢å¤åŸè‰²
function toggleOrnamentColor(type, id){
  const key = (type === 's' ? 's_'+id : 'c_'+id);
  const inst = (type === 's') ? sphereMesh : cubeMesh;
  // if highlighted -> restore original; else set to white/emissive color
  const current = ornamentColors[key];
  if(!current) return;
  // detect current: if white then restore original color saved in data structure? We'll toggle using a simple stored flag.
  if(inst.userData && inst.userData[id] === 'lit'){
    // æ¢å¤
    const orig = current; // ornamentColors stores original color
    inst.setColorAt(id, orig);
    inst.userData[id] = null;
  } else {
    inst.setColorAt(id, new THREE.Color(0xFFFFFF));
    if(!inst.userData) inst.userData = {};
    inst.userData[id] = 'lit';
    // schedule auto-dim after short time
    setTimeout(()=>{ if(inst.userData && inst.userData[id] === 'lit'){ inst.setColorAt(id, current); inst.userData[id]=null; if(inst.instanceColor) inst.instanceColor.needsUpdate=true; inst.instanceMatrix.needsUpdate=true;} }, 900);
  }
  if(inst.instanceColor) inst.instanceColor.needsUpdate = true;
  inst.instanceMatrix.needsUpdate = true;
}

// animate loop
function animateTree(){
  requestAnimationFrame(animateTree);
  const dt = clock.getDelta();

  // slow automatic rotation
  treeGroup.rotation.y += dt * 0.12;

  // subtle particle bob
  treeParticles.forEach(p=>{ p.position.y = p.userData.baseY + Math.sin(clock.elapsedTime*1.2 + p.userData.phase) * 0.6; });

  // star twinkle
  if(starMesh) starMesh.scale.setScalar(1 + Math.sin(clock.elapsedTime*6)*0.06);

  controls.update();
  renderer.render(scene, camera);
}

// é¡µé¢æ»šåŠ¨æ—¶å¾®åŠ¨åœ£è¯æ ‘ï¼ˆä¸Šä¸‹ç§»åŠ¨ï¼‰
window.addEventListener('scroll', ()=>{
  const maxShift = 10; // px
  const scrollFactor = window.scrollY / (document.body.scrollHeight - window.innerHeight);
  treeGroup.position.y = (scrollFactor - 0.4) * maxShift;
});

/* åˆå§‹åŒ–ä¸€åˆ‡ */
initTree3D();
animateTree();
</script>

</body>
</html>
