<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy çš„ä¸ªäººä¸»é¡µ</title>

<!-- LeanCloud SDK -->
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.2/dist/av-min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#f5f5f7;
  color:#111;
  transition:.3s;
}
body.dark{background:#000;color:#eee}
video.bg{
  position:fixed;inset:0;
  width:100%;height:100%;
  object-fit:cover;z-index:-2;
}
.overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.3);z-index:-1;
}
header{
  padding:40px 20px;
  text-align:center;
}
header h1{font-size:32px}
.toggle{
  position:fixed;top:20px;right:20px;
  background:#fff;border-radius:50%;
  width:44px;height:44px;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;
}
body.dark .toggle{background:#222;color:#fff}

.container{max-width:900px;margin:auto;padding:20px}

.card{
  background:rgba(255,255,255,.75);
  backdrop-filter:blur(20px);
  border-radius:20px;
  padding:20px;
  margin-bottom:20px;
}
body.dark .card{background:rgba(20,20,20,.75)}

.card h2{margin-bottom:12px}

input,textarea,button{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid #ccc;
  margin-bottom:10px;
}
button{
  background:#0071e3;
  color:#fff;
  border:none;
  cursor:pointer;
}

.diary-item,.comment-item{
  padding:12px;
  border-bottom:1px solid rgba(0,0,0,.1);
}
body.dark .diary-item,body.dark .comment-item{
  border-color:rgba(255,255,255,.1)
}
.diary-item img{
  max-width:100%;
  border-radius:12px;
  margin-top:8px;
}

#qrModal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:99;
}
#qrModal.show{display:flex}
#qrModal img{width:260px;border-radius:20px}

footer{
  text-align:center;
  opacity:.6;
  padding:30px;
}
</style>
</head>

<body>
<video class="bg" autoplay muted loop>
  <source src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" type="video/mp4">
</video>
<div class="overlay"></div>

<div class="toggle" id="modeBtn">ğŸŒ“</div>

<header>
  <h1>Happy çš„ç©ºé—´</h1>
  <p>è®¿å®¢æ•°ï¼š<span id="visitorCount">0</span></p>
</header>

<div class="container">

<div class="card">
<h2>ğŸ“” å†™æ—¥è®°</h2>
<textarea id="diaryText" placeholder="ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆ"></textarea>
<input type="file" id="diaryImg">
<button id="addDiary">å‘å¸ƒ</button>
<div id="diaryList"></div>
</div>

<div class="card">
<h2>ğŸ’¬ è¯„è®º</h2>
<input id="commentName" placeholder="æ˜µç§°ï¼ˆå¯ç©ºï¼‰">
<textarea id="commentText" placeholder="è¯´ç‚¹ä»€ä¹ˆ"></textarea>
<button id="addComment">æäº¤</button>
<div id="commentList"></div>
</div>

<div class="card">
<h2>ğŸ“± è”ç³»æˆ‘</h2>
<img id="qrThumb" src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=WeChat" style="width:120px;cursor:pointer">
</div>

</div>

<div id="qrModal">
  <img src="https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=WeChat">
</div>

<footer>Â© Happy</footer>

<script>
// ===== LeanCloud åˆå§‹åŒ– =====
AV.init({
  appId: "kCMoxHbSwRcxTuYWaayCMrva-gzGzoHsz",
  appKey: "jL0hefBspKv4LQ67m5IzSLF3",
  serverURL: "https://ä½ çš„åŸŸå.lc-cn-n1-shared.com"
});

// ===== å¤œé—´æ¨¡å¼ =====
const modeBtn=document.getElementById('modeBtn');
modeBtn.onclick=()=>document.body.classList.toggle('dark');

// ===== è®¿å®¢ç»Ÿè®¡ =====
const Visitor=AV.Object.extend('Visitor');
const v=new Visitor();
v.save().then(()=>{
  new AV.Query(Visitor).count().then(c=>{
    document.getElementById('visitorCount').textContent=c;
  });
});

// ===== æ—¥è®° =====
const Diary=AV.Object.extend('Diary');
const diaryList=document.getElementById('diaryList');

function loadDiaries(){
  diaryList.innerHTML='';
  const q=new AV.Query(Diary);
  q.descending('createdAt');
  q.find().then(list=>{
    list.forEach(d=>{
      const div=document.createElement('div');
      div.className='diary-item';
      div.innerHTML=`<div>${d.get('text')}</div>`;
      const img=d.get('img');
      if(img) div.innerHTML+=`<img src="${img}">`;
      diaryList.appendChild(div);
    });
  });
}

document.getElementById('addDiary').onclick=()=>{
  const text=diaryText.value.trim();
  if(!text)return;
  const file=diaryImg.files[0];
  if(file){
    const f=new AV.File(file.name,file);
    f.save().then(fileObj=>{
      const d=new Diary();
      d.set('text',text);
      d.set('img',fileObj.url());
      return d.save();
    }).then(loadDiaries);
  }else{
    const d=new Diary();
    d.set('text',text);
    d.save().then(loadDiaries);
  }
  diaryText.value='';
  diaryImg.value='';
};

loadDiaries();

// ===== è¯„è®º =====
const Comment=AV.Object.extend('Comment');
const commentList=document.getElementById('commentList');

function loadComments(){
  commentList.innerHTML='';
  const q=new AV.Query(Comment);
  q.descending('createdAt');
  q.find().then(list=>{
    list.forEach(c=>{
      const div=document.createElement('div');
      div.className='comment-item';
      div.innerHTML=`<strong>${c.get('name')||'åŒ¿å'}ï¼š</strong>${c.get('text')}`;
      commentList.appendChild(div);
    });
  });
}

document.getElementById('addComment').onclick=()=>{
  const text=commentText.value.trim();
  if(!text)return;
  const c=new Comment();
  c.set('name',commentName.value.trim());
  c.set('text',text);
  c.save().then(loadComments);
  commentName.value='';
  commentText.value='';
};

loadComments();

// ===== äºŒç»´ç  =====
const qrModal=document.getElementById('qrModal');
qrThumb.onclick=()=>qrModal.classList.add('show');
qrModal.onclick=e=>{
  if(e.target===qrModal)qrModal.classList.remove('show');
};
</script>
</body>
</html>
