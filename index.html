<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy çš„ä¸ªäººä¸»é¡µ â€” åœ£è¯ç‰¹åˆ«ç‰ˆ</title>
<style>
/* --- å…¨å±€æ ·å¼ --- */
:root{--card-w:320px}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;background:#0f1720;color:#222;transition:color .3s; overflow-x: hidden;}
body.dark{background:#0b0b0d;color:#eee}

/* --- èƒŒæ™¯å±‚ (è§†é¢‘ & 2Dç²’å­) --- */
#bgVideo{position:fixed;left:0;top:0;width:100%;height:100%;object-fit:cover;z-index:-2;transition:filter .4s}
body.dark #bgVideo{filter:brightness(.38) contrast(1.05)}
#particles{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:-1;}

/* --- å·¦ä¾§ 3D åœ£è¯æ ‘å¡ç‰‡ (Fixed å®šä½) --- */
/* ä¿®å¤ï¼šæé«˜ z-index ç¡®ä¿æ ‘èƒ½è¢«ç‚¹åˆ°ï¼Œä¸”èƒŒæ™¯æ¨¡ç³Šå¯è§ */
#treeCard{
  position:fixed; 
  left:40px; /* ç¨å¾®å¾€å³ä¸€ç‚¹ï¼Œé¿å…è´´è¾¹ */
  top:50%; 
  transform:translateY(-50%);
  width:400px; 
  height:600px; 
  border-radius:24px;
  background:rgba(255,255,255,0.02); /* ææ·¡èƒŒæ™¯ */
  box-shadow:0 12px 40px rgba(0,0,0,0.4);
  backdrop-filter:blur(4px); 
  overflow:hidden; 
  z-index:10; /* ä¿è¯åœ¨èƒŒæ™¯ä¹‹ä¸Š */
  cursor:pointer;
  transition: transform 0.3s ease;
}
#treeCard canvas{width:100%;height:100%;display:block;outline:none;}

/* --- é¡µé¢å³ä¾§ä¸»å†…å®¹ --- */
/* ä¿®å¤ï¼šåœ¨å¤§å±æ—¶å·¦è¾¹è·ç•™ç™½ç»™æ ‘ï¼Œå°å±æ—¶å–æ¶ˆ */
.mainContent{position:relative;z-index:5;margin-left:480px;padding-bottom:60px;min-height:100vh; transition: margin-left 0.3s;}

/* --- å“åº”å¼å¸ƒå±€ï¼šå±å¹•å˜çª„æ—¶éšè—æ ‘ï¼Œå†…å®¹å±…ä¸­ --- */
@media(max-width:1100px){ 
  #treeCard{display:none} 
  .mainContent{margin-left:0} 
}

/* --- å¤´éƒ¨ä¸å¯¼èˆª --- */
header{text-align:center;padding:44px 20px 8px}
header img{width:120px;height:120px;border-radius:50%;border:3px solid rgba(255,255,255,.08);display:block;margin:0 auto 12px;object-fit:cover}
h1{margin:6px 0;font-size:28px; color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.5);}
p.lead{margin:6px 0;color:rgba(255,255,255,.8);font-size:14px}
nav{position:sticky;top:12px;margin:14px auto 0;background:rgba(255,255,255,.1);backdrop-filter:blur(10px);padding:8px;border-radius:14px;width:fit-content;z-index:20; box-shadow: 0 4px 15px rgba(0,0,0,0.2);}
nav a{margin:0 12px;color:#fff;text-decoration:none;font-weight:600}

/* --- åŠŸèƒ½æŒ‰é’® --- */
#modeToggle{position:fixed;right:20px;top:20px;z-index:21;padding:8px 14px;border-radius:20px;background:linear-gradient(135deg,#5ac8fa,#007aff);color:white;cursor:pointer;font-size:14px;box-shadow: 0 4px 10px rgba(0,122,255,0.3);}
#toTopBtn{position:fixed;right:20px;bottom:22px;z-index:21;padding:10px 14px;border-radius:24px;background:linear-gradient(135deg,#5ac8fa,#007aff);color:#fff;border:none;cursor:pointer;display:none;box-shadow: 0 4px 10px rgba(0,122,255,0.3);}

/* --- å¡ç‰‡é€šç”¨æ ·å¼ --- */
section{padding:56px 18px;text-align:center}
.card{
  width:var(--card-w);
  margin:0 auto 22px;
  padding:18px;
  border-radius:18px;
  /* ä¼˜åŒ–å¡ç‰‡èƒŒæ™¯ï¼Œå¢åŠ ä¸€ç‚¹è´¨æ„Ÿ */
  background:linear-gradient(180deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
  backdrop-filter:blur(12px);
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
  color: #fff;
}
body:not(.dark) .card { color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.5); } /* å³ä½¿åœ¨æµ…è‰²æ¨¡å¼ï¼Œå¡ç‰‡æ–‡å­—ä¹Ÿä¿ç•™ç™½è‰²ä»¥ä¾¿é˜…è¯» */

.card .tags{margin-top:8px}
.tag{display:inline-block;padding:6px 10px;border-radius:12px;margin:4px;background:linear-gradient(45deg,#5ac8fa,#007aff);color:#fff;font-size:13px}

/* --- æ—¥è®°æ¨¡å— --- */
#diary .card{width:360px;padding:14px; max-width: 90%;}
input[type="date"],textarea{width:90%;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);margin:6px auto;display:block;background:rgba(0,0,0,0.3);color:#fff; font-family: inherit;}
#addDiaryBtn{display:inline-block;padding:10px 24px;border-radius:22px;background:linear-gradient(135deg,#32d74b,#0a84ff);color:#fff;border:none;font-weight:700;font-size:16px;cursor:pointer; margin-top: 10px;}
.diary-actions button{padding:6px 12px;border-radius:16px;background:rgba(255,255,255,0.1);border:none;color:#fff;cursor:pointer;margin-left:6px;font-size:12px}

/* --- äºŒç»´ç  --- */
.contact .qr img{width:140px;height:140px;border-radius:18px;cursor:pointer; transition: transform 0.2s;}
.contact .qr img:hover{transform: scale(1.05);}

/* --- æ¨¡æ€æ¡† --- */
#qrModal{position:fixed;left:0;top:0;width:100%;height:100%;z-index:100;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);backdrop-filter: blur(5px);}
#qrModal img{max-width:320px;border-radius:16px;border:4px solid rgba(255,255,255,0.12);box-shadow: 0 0 30px rgba(0,0,0,0.5);}

/* --- å“åº”å¼å°å±è°ƒæ•´ --- */
@media(max-width:480px){
  #addDiaryBtn{padding:10px 14px;font-size:15px}
  .card{width:92%}
  nav a { margin: 0 8px; font-size: 14px; }
}
</style>
</head>
<body class="dark"> <video id="bgVideo" autoplay muted loop playsinline>
  <source src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/Video%20Project%204.mp4?raw=true" type="video/mp4">
</video>

<canvas id="particles"></canvas>

<div id="treeCard" title="ç‚¹å‡»æ ‘ä½“æ”¾å¤§æˆ–ç‚¹äº®è£…é¥°">
  <canvas id="treeCanvas"></canvas>
</div>

<div class="mainContent">
  <header>
    <img src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20251207233412_9_79.jpg?raw=true" alt="å¤´åƒ">
    <h1>æ¬¢è¿æ¥åˆ° Happy çš„ä¸»é¡µ</h1>
    <p class="lead">è®°å½•æˆ‘çš„æ—¥å¸¸å’Œç‚¹æ»´ ğŸ„ Merry Christmas!</p>
    <nav id="mainNav">
      <a href="#about">å…³äºæˆ‘</a>
      <a href="#diary">æ—¥è®°</a>
      <a href="#contact">è”ç³»æˆ‘</a>
    </nav>
  </header>

  <div id="modeToggle">ğŸŒ™ æ—¥/å¤œåˆ‡æ¢</div>
  <button id="toTopBtn">â¬†ï¸ é¡¶éƒ¨</button>

  <section id="about">
    <h2>å…³äºæˆ‘</h2>
    <div class="card">
      <p>Hi æˆ‘æ˜¯ Happyï¼Œæ¥è‡ªæ²³å—éƒ‘å·ã€‚<br>ç›®å‰æ˜¯éƒ‘å·è¥¿äºšæ–¯å­¦é™¢çš„å¤§ä¸€å­¦ç”Ÿã€‚<br>åœ¨æ­¤åˆ†äº«æˆ‘çš„å¤§å­¦ç”Ÿæ´»ä¸å…´è¶£ã€‚</p>
      <div class="tags">
        <span class="tag">ğŸ“š å­¦ä¹ </span>
        <span class="tag">ğŸ® æ¸¸æˆ</span>
        <span class="tag">ğŸµ éŸ³ä¹</span>
        <span class="tag">ğŸ’» ç¼–ç¨‹</span>
      </div>
    </div>
  </section>

  <section id="diary">
    <h2>æˆ‘çš„æ—¥è®° ğŸ“–</h2>
    <div class="card">
      <input id="diaryDate" type="date" />
      <textarea id="diaryContent" rows="3" placeholder="å†™ä¸‹ä»Šå¤©çš„æ—¥è®°..."></textarea>
      <div style="text-align:center;">
        <button id="addDiaryBtn">æ·»åŠ æ—¥è®°</button>
      </div>
    </div>
    <div id="diaryList"></div>
  </section>

  <section id="contact">
    <h2>è”ç³»æˆ‘</h2>
    <p>å¾®ä¿¡ï¼š<strong>H4ppy_ma</strong></p>
    <div class="card contact">
      <div class="qr">
        <img id="qrImg" src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20251207233522_10_79.jpg?raw=true" alt="å¾®ä¿¡äºŒç»´ç ">
      </div>
    </div>
  </section>

  <footer style="text-align:center;padding:18px;color:rgba(255,255,255,0.45)">
    &copy; 2025 Happyma.top <br> Best Wishes for You
  </footer>

  <div id="qrModal">
    <img src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20251207233522_10_79.jpg?raw=true" alt="äºŒç»´ç å¤§å›¾">
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>

<script>
/* =========================================
   PART 1: ä¸ªäººä¸»é¡µé€»è¾‘ (æ—¥è®°ã€äº¤äº’ã€èƒŒæ™¯ç²’å­)
   ========================================= */

// --- æ—¥è®°åŠŸèƒ½ ---
const diaryList = document.getElementById('diaryList');
const addDiaryBtn = document.getElementById('addDiaryBtn');
const diaryDate = document.getElementById('diaryDate');
const diaryContent = document.getElementById('diaryContent');

// ä¿®å¤ï¼šæ·»åŠ  localStorage é”™è¯¯å¤„ç†ï¼Œé˜²æ­¢é¦–æ¬¡è®¿é—®æŠ¥é”™
let diaries = [];
try {
    diaries = JSON.parse(localStorage.getItem('diaries')) || [
      {date:'2025-12-08', content:'ä»Šå¤©æ˜¯æˆ‘åˆæ¬¡åˆ›å»ºæˆ‘çš„ä¸ªäººç½‘ç«™ï¼Œç›®å‰è¿˜åœ¨æµ‹è¯•ä¸­ã€‚åœ£è¯èŠ‚å¿«åˆ°äº†ï¼ğŸ„'}
    ];
} catch(e) { diaries = []; }

function renderDiaries(){
  diaryList.innerHTML = '';
  diaries.forEach((d,i)=>{
    const entry = document.createElement('div');
    entry.className = 'card diary-entry';
    entry.style.textAlign = 'left'; // æ—¥è®°å†…å®¹å·¦å¯¹é½æ›´å¥½é˜…è¯»
    entry.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:4px;">
        <strong style="color:#5ac8fa">${d.date}</strong>
        <div class="diary-actions">
           <button onclick="editDiary(${i})">âœï¸</button>
           <button onclick="deleteDiary(${i})">ğŸ—‘ï¸</button>
        </div>
      </div>
      <p style="white-space:pre-wrap;margin:0;line-height:1.6;">${d.content}</p>
    `;
    diaryList.appendChild(entry);
  });
  localStorage.setItem('diaries', JSON.stringify(diaries));
}
renderDiaries();

addDiaryBtn.addEventListener('click', ()=>{
  const dateVal = diaryDate.value || new Date().toISOString().split('T')[0];
  const contentVal = diaryContent.value.trim();
  if(!contentVal){ alert('è¯·å¡«å†™æ—¥è®°å†…å®¹'); return; }
  diaries.unshift({date:dateVal, content:contentVal});
  diaryContent.value='';
  renderDiaries();
});

window.editDiary = function(i){
  const newText = prompt('ç¼–è¾‘æ—¥è®°ï¼š', diaries[i].content);
  if(newText !== null){ diaries[i].content = newText; renderDiaries(); }
};
window.deleteDiary = function(i){
  if(confirm('ç¡®è®¤åˆ é™¤è¿™æ¡æ—¥è®°å—ï¼Ÿ')){ diaries.splice(i,1); renderDiaries(); }
};

// --- äºŒç»´ç å¼¹çª— ---
const qrImg = document.getElementById('qrImg');
const qrModal = document.getElementById('qrModal');
qrImg.addEventListener('click', (e)=>{ e.stopPropagation(); qrModal.style.display = 'flex'; });
qrModal.addEventListener('click', ()=>{ qrModal.style.display = 'none'; });

// --- æ—¥å¤œåˆ‡æ¢ ---
const modeToggle = document.getElementById('modeToggle');
modeToggle.addEventListener('click', ()=>{
  document.body.classList.toggle('dark');
  initBgParticles(); // é‡æ–°ç”ŸæˆèƒŒæ™¯ç²’å­ä»¥é€‚é…é¢œè‰²
});

// --- è¿”å›é¡¶éƒ¨ & å¯¼èˆªé«˜äº® ---
const toTopBtn = document.getElementById('toTopBtn');
window.addEventListener('scroll', ()=>{
  toTopBtn.style.display = (window.scrollY > 300) ? 'block' : 'none';
  // ç®€å•çš„é«˜äº®é€»è¾‘
  const scrollPos = window.scrollY + 100;
  document.querySelectorAll('#mainNav a').forEach(link=>{
    const section = document.querySelector(link.getAttribute('href'));
    if(section && section.offsetTop <= scrollPos && (section.offsetTop + section.offsetHeight) > scrollPos){
      link.style.color = '#ffeb3b';
    } else {
      link.style.color = '#fff';
    }
  });
});
toTopBtn.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}) );


/* --- èƒŒæ™¯ 2D ç²’å­ç³»ç»Ÿ (Canvas #particles) --- */
const bgCanvas = document.getElementById('particles');
const bgCtx = bgCanvas.getContext('2d');
let bgParticlesArray = [];
let mouse = {x:null,y:null};

function resizeBgCanvas(){ 
    bgCanvas.width = window.innerWidth; 
    bgCanvas.height = window.innerHeight; 
}
window.addEventListener('resize', resizeBgCanvas);
resizeBgCanvas();
window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });

class BGParticle {
  constructor(){ this.reset(); }
  reset(){
    this.x = Math.random()*bgCanvas.width;
    this.y = Math.random()*bgCanvas.height;
    this.r = Math.random()*2+1;
    this.speedX = (Math.random()-0.5)*0.5;
    this.speedY = (Math.random()-0.5)*0.5;
    this.color = document.body.classList.contains('dark') ? 'rgba(255,255,255,0.8)' : 'rgba(255,255,255,0.4)';
  }
  update(){
    this.x += this.speedX; this.y += this.speedY;
    // é¼ æ ‡äº’åŠ¨
    if(mouse.x != null){
        let dx = mouse.x - this.x;
        let dy = mouse.y - this.y;
        let distance = Math.sqrt(dx*dx + dy*dy);
        if(distance < 100){
            this.x -= dx/20;
            this.y -= dy/20;
        }
    }
    if(this.x<0 || this.x>bgCanvas.width || this.y<0 || this.y>bgCanvas.height) this.reset();
  }
  draw(){ 
      bgCtx.fillStyle = this.color; 
      bgCtx.beginPath(); 
      bgCtx.arc(this.x,this.y,this.r,0,Math.PI*2); 
      bgCtx.fill(); 
  }
}

function initBgParticles(){
  bgParticlesArray = [];
  const count = document.body.classList.contains('dark') ? 100 : 50;
  for(let i=0;i<count;i++) bgParticlesArray.push(new BGParticle());
}
initBgParticles();

function animateBgParticles(){ 
    bgCtx.clearRect(0,0,bgCanvas.width,bgCanvas.height); 
    bgParticlesArray.forEach(p=>{ p.update(); p.draw(); }); 
    requestAnimationFrame(animateBgParticles); 
}
animateBgParticles();


/* =========================================
   PART 2: THREE.JS 3D åœ£è¯æ ‘é€»è¾‘
   (å•ç‹¬å°è£…ï¼Œé˜²æ­¢å˜é‡æ±¡æŸ“)
   ========================================= */
(function(){
    const treeCanvas = document.getElementById('treeCanvas');
    const treeCard = document.getElementById('treeCard');

    let renderer, scene, camera, controls, treeGroup;
    let sphereMesh, cubeMesh, starMesh;
    let clock = new THREE.Clock();
    let raycaster = new THREE.Raycaster();
    // ç²’å­
    let treeSnowParticles = [];

    // åˆå§‹åŒ– 3D åœºæ™¯
    function initTree(){
        if(!treeCanvas || !treeCard) return;
        
        const w = treeCard.clientWidth;
        const h = treeCard.clientHeight;

        renderer = new THREE.WebGLRenderer({canvas: treeCanvas, alpha:true, antialias:true});
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.setSize(w, h);
        renderer.setClearColor(0x000000, 0); // é€æ˜èƒŒæ™¯

        scene = new THREE.Scene();
        // è°ƒæ•´ç›¸æœºä½ç½®ï¼Œç¡®ä¿æ ‘åœ¨è§†å›¾ä¸­å¿ƒ
        camera = new THREE.PerspectiveCamera(45, w/h, 0.1, 1000);
        camera.position.set(0, 10, 70); 

        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableZoom = false; 
        controls.enablePan = false; 
        controls.autoRotate = true;
        controls.autoRotateSpeed = 2.0; // è‡ªåŠ¨æ—‹è½¬é€Ÿåº¦

        // ç¯å…‰
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
        dirLight.position.set(20, 50, 20);
        scene.add(dirLight);

        // åˆ›å»ºæ ‘ç»„
        treeGroup = new THREE.Group();
        scene.add(treeGroup);

        // --- æ„å»ºæ ‘ä½“ (ä½¿ç”¨ InstancedMesh æå‡æ€§èƒ½) ---
        const layers = 12; // å±‚æ•°
        const countPerLayer = 15;
        const totalInstances = layers * countPerLayer;

        const sphereGeo = new THREE.SphereGeometry(1.2, 16, 16);
        const goldMat = new THREE.MeshStandardMaterial({color: 0xffd700, roughness: 0.3, metalness: 0.6});
        const greenMat = new THREE.MeshStandardMaterial({color: 0x0f6b36, roughness: 0.8});
        
        // æˆ‘ä»¬æ··åˆä½¿ç”¨çƒä½“ï¼ˆè£…é¥°ï¼‰å’Œæ–¹å—ï¼ˆæ ‘å¶æ„Ÿï¼‰
        sphereMesh = new THREE.InstancedMesh(sphereGeo, goldMat, totalInstances);
        cubeMesh = new THREE.InstancedMesh(new THREE.BoxGeometry(2,2,2), greenMat, totalInstances * 2);
        
        treeGroup.add(sphereMesh);
        treeGroup.add(cubeMesh);

        const dummy = new THREE.Object3D();
        const color = new THREE.Color();
        let idxSphere = 0;
        let idxCube = 0;

        for(let l=0; l<layers; l++){
            // å±‚çº§è¶Šé«˜ï¼ŒåŠå¾„è¶Šå°ï¼ŒYè½´è¶Šé«˜
            const y = (l * 3.5) - 20; 
            const radius = (layers - l) * 1.8 + 2;

            // æ¯ä¸€å±‚çš„ç‰©ä½“
            for(let i=0; i<countPerLayer * 2; i++){
                const angle = (i / (countPerLayer*2)) * Math.PI * 2 + (l*0.5);
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                
                dummy.position.set(x, y, z);
                dummy.lookAt(0, y, 0); // é¢å‘ä¸­å¿ƒ
                dummy.scale.setScalar(0.8 + Math.random()*0.5);
                dummy.updateMatrix();

                // éšæœºå†³å®šæ˜¯ç»¿å¶è¿˜æ˜¯é‡‘çƒ
                if(Math.random() > 0.8 && idxSphere < totalInstances){
                    // é‡‘çƒè£…é¥°
                    sphereMesh.setMatrixAt(idxSphere, dummy.matrix);
                    // éšæœºé¢œè‰²ï¼šé‡‘ã€çº¢ã€é“¶
                    const rand = Math.random();
                    if(rand>0.6) color.setHex(0xffd700); // é‡‘
                    else if(rand>0.3) color.setHex(0xff3333); // çº¢
                    else color.setHex(0xffffff); // é“¶
                    sphereMesh.setColorAt(idxSphere, color);
                    idxSphere++;
                } else if (idxCube < totalInstances * 2) {
                    // ç»¿å¶
                    cubeMesh.setMatrixAt(idxCube, dummy.matrix);
                    // ç»¿è‰²å¾®è°ƒ
                    color.setHSL(0.35, 0.8, 0.2 + Math.random()*0.2); 
                    cubeMesh.setColorAt(idxCube, color);
                    idxCube++;
                }
            }
        }
        
        // æ ‘é¡¶æ˜Ÿæ˜Ÿ
        const starGeo = new THREE.OctahedronGeometry(3, 0);
        const starMat = new THREE.MeshStandardMaterial({color:0xffff00, emissive:0xffaa00, emissiveIntensity:0.5});
        starMesh = new THREE.Mesh(starGeo, starMat);
        starMesh.position.set(0, (layers * 3.5) - 18, 0);
        treeGroup.add(starMesh);

        // æ ‘é™„è¿‘çš„å±€éƒ¨é›ªèŠ±
        const snowGeo = new THREE.BufferGeometry();
        const snowCount = 200;
        const posArray = new Float32Array(snowCount * 3);
        const velArray = []; // é€Ÿåº¦
        for(let i=0; i<snowCount; i++){
            posArray[i*3] = (Math.random()-0.5) * 40;
            posArray[i*3+1] = (Math.random()-0.5) * 50;
            posArray[i*3+2] = (Math.random()-0.5) * 40;
            velArray.push({y: -0.05 - Math.random()*0.1, x: (Math.random()-0.5)*0.02});
        }
        snowGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const snowMat = new THREE.PointsMaterial({
            color: 0xffffff, 
            size: 0.8, 
            transparent: true, 
            opacity: 0.8
        });
        const snowSystem = new THREE.Points(snowGeo, snowMat);
        snowSystem.userData = { vels: velArray };
        scene.add(snowSystem);
        treeSnowParticles = snowSystem;

        // ç‚¹å‡»äº¤äº’
        treeCanvas.addEventListener('pointerdown', onTreeClick);
    }

    // æ ‘è¢«ç‚¹å‡»æ—¶çš„æ•ˆæœ
    function onTreeClick(){
        // ç®€å•äº¤äº’ï¼šæ”¾å¤§ä¸€ä¸‹å¡ç‰‡
        if(treeCard.style.transform.includes('scale')){
             treeCard.style.transform = 'translateY(-50%) scale(1)';
        } else {
             treeCard.style.transform = 'translateY(-50%) scale(1.05)';
        }
    }

    // åŠ¨ç”»å¾ªç¯
    function animate(){
        requestAnimationFrame(animate);
        const dt = clock.getDelta();
        
        controls.update(); // è‡ªåŠ¨æ—‹è½¬

        // æ˜Ÿæ˜Ÿé—ªçƒ
        if(starMesh){
            starMesh.rotation.y += dt;
            const s = 1 + Math.sin(clock.elapsedTime * 3) * 0.1;
            starMesh.scale.set(s,s,s);
        }

        // å±€éƒ¨é›ªèŠ±ä¸‹è½
        if(treeSnowParticles){
            const positions = treeSnowParticles.geometry.attributes.position.array;
            const vels = treeSnowParticles.userData.vels;
            for(let i=0; i<vels.length; i++){
                positions[i*3+1] += vels[i].y; // Yè½´ä¸‹é™
                positions[i*3] += vels[i].x;   // Xè½´å¾®åŠ¨
                // å¾ªç¯å¤ä½
                if(positions[i*3+1] < -25){
                    positions[i*3+1] = 25;
                }
            }
            treeSnowParticles.geometry.attributes.position.needsUpdate = true;
        }

        renderer.render(scene, camera);
    }

    // çª—å£å¤§å°é€‚é…
    window.addEventListener('resize', ()=>{
        if(!treeCard || !camera || !renderer) return;
        const w = treeCard.clientWidth;
        const h = treeCard.clientHeight;
        camera.aspect = w/h;
        camera.updateProjectionMatrix();
        renderer.setSize(w, h);
    });

    // å¯åŠ¨
    initTree();
    animate();
})();
</script>

</body>
</html>
