<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy çš„ä¸ªäººä¸»é¡µ â€” åœ£è¯å‡çº§ç‰ˆï¼ˆä¿®å¤ç‰ˆï¼‰</title>
<style>
:root{--card-w:320px}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;background:#0f1720;color:#222;transition:color .3s}
body.dark{background:#0b0b0d;color:#eee}

/* èƒŒæ™¯è§†é¢‘ & ç²’å­ */
#bgVideo{position:fixed;left:0;top:0;width:100%;height:100%;object-fit:cover;z-index:0;transition:filter .4s}
body.dark #bgVideo{filter:brightness(.38) contrast(1.05)}
#particles{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:1}

/* å·¦ä¾§åœ£è¯æ ‘å¡ç‰‡ï¼ˆä¼˜å…ˆçº§åœ¨ç²’å­ä¹‹ä¸Šï¼Œä¸”å¯äº¤äº’ï¼‰ */
#treeCard{
Â  position:fixed; left:20px; top:50%; transform:translateY(-50%);
Â  width:400px; height:600px; border-radius:24px;
Â  background:rgba(255,255,255,0.04); box-shadow:0 12px 40px rgba(2,6,23,0.6);
Â  backdrop-filter:blur(8px); overflow:hidden; z-index:5; cursor:pointer;
Â  display:flex; align-items:center; justify-content:center;
Â  pointer-events:auto;
}
/* å…³é”®ä¿®å¤ï¼šç¡®ä¿ canvas å¯è§å¹¶åœ¨å¡ç‰‡å†…æ­£ç¡®å †å ä¸æ¥æ”¶äº¤äº’ */
#treeCard canvas{width:100%;height:100%;display:block;position:relative;z-index:10;pointer-events:auto}

/* é¡µé¢ä¸»ä½“å³ç§»ä»¥é¿å¼€æ ‘ï¼ˆæ¡Œé¢ï¼‰ */
.mainContent{position:relative;z-index:2;margin-left:460px;padding-bottom:60px;min-height:100vh}
/* å°å±éšè—æ ‘å¹¶æ¢å¤å¸ƒå±€ */
@media(max-width:900px){ #treeCard{display:none} .mainContent{margin-left:0} }

/* å¤´éƒ¨ä¸å¯¼èˆª */
header{text-align:center;padding:44px 20px 8px}
header img{width:120px;height:120px;border-radius:50%;border:3px solid rgba(255,255,255,.08);display:block;margin:0 auto 12px;object-fit:cover}
h1{margin:6px 0;font-size:28px}
p.lead{margin:6px 0;color:rgba(255,255,255,.7);font-size:14px}
nav{position:sticky;top:12px;margin:14px auto 0;background:rgba(255,255,255,.02);padding:8px;border-radius:14px;width:fit-content;z-index:20}
nav a{margin:0 12px;color:inherit;text-decoration:none;font-weight:600}

/* æ—¥å¤œåˆ‡æ¢ & è¿”å›é¡¶éƒ¨ */
#modeToggle{position:fixed;right:20px;top:20px;z-index:21;padding:8px 14px;border-radius:20px;background:linear-gradient(135deg,#5ac8fa,#007aff);color:white;cursor:pointer}
#toTopBtn{position:fixed;right:20px;bottom:22px;z-index:21;padding:10px 14px;border-radius:24px;background:linear-gradient(135deg,#5ac8fa,#007aff);color:#fff;border:none;cursor:pointer;display:none}

/* å¡ç‰‡æ ·å¼ */
section{padding:56px 18px;text-align:center}
.card{width:var(--card-w);margin:0 auto 22px;padding:18px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));backdrop-filter:blur(10px);box-shadow:0 10px 30px rgba(2,6,23,0.6);color:inherit}
.card .tags{margin-top:8px}
.tag{display:inline-block;padding:6px 10px;border-radius:12px;margin:4px;background:linear-gradient(45deg,#5ac8fa,#007aff);color:#fff;font-size:13px}

/* æ—¥è®°ï¼šè¾“å…¥å°å·§å¹¶å±…ä¸­ */
#diary .card{width:360px;padding:14px}
input[type="date"],textarea{width:80%;padding:8px;border-radius:12px;border:none;margin:6px auto;display:block;background:rgba(0,0,0,0.25);color:inherit}
#addDiaryBtn{display:inline-block;padding:12px 18px;border-radius:22px;background:linear-gradient(135deg,#3db0ff,#006ee6);color:#fff;border:none;font-weight:800;font-size:16px;cursor:pointer}
.diary-actions button{padding:6px 10px;border-radius:16px;background:rgba(255,255,255,0.06);border:none;color:inherit;cursor:pointer;margin-left:6px;font-size:13px}

/* è”ç³»ï¼šäºŒç»´ç  */
.contact .qr img{width:140px;height:140px;border-radius:18px;cursor:pointer}

/* QR modalï¼ˆé»˜è®¤éšè—ï¼‰ */
#qrModal{position:fixed;left:0;top:0;width:100%;height:100%;z-index:60;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6)}
#qrModal img{max-width:320px;border-radius:16px;border:4px solid rgba(255,255,255,0.12)}

/* å“åº”å¼å°å± */
@media(max-width:480px){
Â  #addDiaryBtn{padding:10px 14px;font-size:15px}
Â  .card{width:92%}
}
</style>
</head>
<body>

<video id="bgVideo" autoplay muted loop playsinline>
Â  <source src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/Video%20Project%204.mp4?raw=true" type="video/mp4">
</video>
<canvas id="particles"></canvas>

<div id="treeCard" title="ç‚¹å‡»æ ‘ä½“æ”¾å¤§æˆ–ç‚¹äº®è£…é¥°">
Â  <canvas id="treeCanvas"></canvas>
</div>

<div class="mainContent">
Â  <header>
Â  Â  <img src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20251207233412_9_79.jpg?raw=true" alt="å¤´åƒ">
Â  Â  <h1>æ¬¢è¿æ¥åˆ° Happy çš„ä¸»é¡µ</h1>
Â  Â  <p class="lead">è®°å½•æˆ‘çš„æ—¥å¸¸å’Œç‚¹æ»´ ğŸ˜Š</p>
Â  Â  <nav id="mainNav">
Â  Â  Â  <a href="#about">å…³äºæˆ‘</a>
Â  Â  Â  <a href="#diary">æ—¥è®°</a>
Â  Â  Â  <a href="#contact">è”ç³»æˆ‘</a>
Â  Â  </nav>
Â  </header>

Â  <div id="modeToggle">ğŸŒ™ æ—¥/å¤œåˆ‡æ¢</div>
Â  <button id="toTopBtn">â¬†ï¸ é¡¶éƒ¨</button>

Â  <section id="about">
Â  Â  <h2>å…³äºæˆ‘</h2>
Â  Â  <div class="card">
Â  Â  Â  <p>Hi æˆ‘æ˜¯happyÂ  æˆ‘æ¥è‡ªæ²³å—éƒ‘å·å¸‚Â  ç›®å‰æ˜¯éƒ‘å·å¸‚è¥¿äºšæ–¯å¤§ä¸€å­¦ç”ŸÂ  åœ¨æ­¤æˆ‘æƒ³åˆ†äº«æˆ‘çš„ç”Ÿæ´»</p>
Â  Â  Â  <div class="tags">
Â  Â  Â  Â  <span class="tag">å­¦ä¹ </span><span class="tag">æ¸¸æˆ</span><span class="tag">éŸ³ä¹</span><span class="tag">ç¼–ç¨‹</span>
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>

Â  <section id="diary">
Â  Â  <h2>æˆ‘çš„æ—¥è®° ğŸ“–</h2>
Â  Â  <div class="card">
Â  Â  Â  <input id="diaryDate" type="date" />
Â  Â  Â  <textarea id="diaryContent" rows="3" placeholder="å†™ä¸‹ä»Šå¤©çš„æ—¥è®°..."></textarea>
Â  Â  Â  <div style="text-align:center;margin-top:6px">
Â  Â  Â  Â  <button id="addDiaryBtn">æ·»åŠ æ—¥è®°</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="diaryList"></div>
Â  </section>

Â  <section id="contact">
Â  Â  <h2>è”ç³»æˆ‘</h2>
Â  Â  <p>å¾®ä¿¡ï¼š<strong>H4ppy_ma</strong></p>
Â  Â  <div class="card contact">
Â  Â  Â  <div class="qr">
Â  Â  Â  Â  <img id="qrImg" src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20251207233522_10_79.jpg?raw=true" alt="å¾®ä¿¡äºŒç»´ç ">
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>

Â  <footer style="text-align:center;padding:18px;color:rgba(255,255,255,0.45)">&copy; 2025 Happyma.top</footer>

Â  Â  <div id="qrModal">
Â  Â  <img src="https://github.com/Happyma-4869/Happyma-4869.github.io/blob/main/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20251207233522_10_79.jpg?raw=true" alt="äºŒç»´ç å¤§å›¾">
Â  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>

<script>
/* ===========================
Â  Â æ—¥è®° / UI / èƒŒæ™¯ç²’å­
Â  Â ============================ */
const diaryList = document.getElementById('diaryList');
const addDiaryBtn = document.getElementById('addDiaryBtn');
const diaryDate = document.getElementById('diaryDate');
const diaryContent = document.getElementById('diaryContent');
const qrImg = document.getElementById('qrImg');
const qrModal = document.getElementById('qrModal');

let diaries = JSON.parse(localStorage.getItem('diaries')) || [
Â  {date:'2025-12-08', content:'ä»Šå¤©æ˜¯æˆ‘åˆæ¬¡åˆ›å»ºæˆ‘çš„ä¸ªäººç½‘ç«™Â  ç›®å‰è¿˜åœ¨æµ‹è¯•ä¸­Â  ä»¥åæˆ‘ä¼šé€æ­¥å®Œå–„è€¶âœŒ'}
];

function renderDiaries(){
Â  diaryList.innerHTML = '';
Â  diaries.forEach((d,i)=>{
Â  Â  const entry = document.createElement('div');
Â  Â  entry.className = 'card diary-entry';
Â  Â  entry.innerHTML = `<p><strong>${d.date}</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="white-space:pre-wrap">${d.content}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="diary-actions">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="editDiary(${i})">ç¼–è¾‘</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="deleteDiary(${i})">åˆ é™¤</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  diaryList.appendChild(entry);
Â  });
Â  localStorage.setItem('diaries', JSON.stringify(diaries));
}
renderDiaries();

addDiaryBtn.addEventListener('click', ()=>{
Â  const dateVal = diaryDate.value || new Date().toISOString().split('T')[0];
Â  const contentVal = diaryContent.value.trim();
Â  if(!contentVal){ alert('è¯·å¡«å†™å†…å®¹'); return; }
Â  diaries.unshift({date:dateVal, content:contentVal});
Â  diaryDate.value=''; diaryContent.value='';
Â  renderDiaries();
});
window.editDiary = function(i){
Â  const newText = prompt('ç¼–è¾‘æ—¥è®°ï¼š', diaries[i].content);
Â  if(newText === null) return;
Â  diaries[i].content = newText;
Â  renderDiaries();
};
window.deleteDiary = function(i){
Â  if(!confirm('ç¡®è®¤åˆ é™¤è¿™æ¡æ—¥è®°ï¼Ÿ')) return;
Â  diaries.splice(i,1);
Â  renderDiaries();
};

// QR modal
qrImg.addEventListener('click', ()=>{ qrModal.style.display = 'flex'; });
qrModal.addEventListener('click', ()=>{ qrModal.style.display = 'none'; });

// æ—¥å¤œåˆ‡æ¢
const modeToggle = document.getElementById('modeToggle');
modeToggle.addEventListener('click', ()=>{
Â  document.body.classList.toggle('dark');
Â  initParticles(); // é‡åˆ·ç²’å­æ•°é‡/é¢œè‰²
});

// è¿”å›é¡¶éƒ¨ & å¯¼èˆªé«˜äº®
const toTopBtn = document.getElementById('toTopBtn');
window.addEventListener('scroll', ()=>{
Â  toTopBtn.style.display = (window.scrollY > 200) ? 'block' : 'none';
Â  // nav highlight
Â  const navLinks = document.querySelectorAll('#mainNav a');
Â  navLinks.forEach(link=>{
Â  Â  const s = document.querySelector(link.getAttribute('href'));
Â  Â  if(!s) return;
Â  Â  if(window.scrollY >= s.offsetTop - 80 && window.scrollY < s.offsetTop + s.offsetHeight){
Â  Â  Â  link.style.color = '#ffeb3b';
Â  Â  } else link.style.color = '';
Â  });
});
toTopBtn.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}) );

/* ---------- èƒŒæ™¯ç²’å­ç”»å¸ƒ ---------- */
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let particlesArray = [];
let mouse = {x:null,y:null};
function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();
window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });

class BGParticle {
Â  constructor(){ this.reset(); }
Â  reset(){
Â  Â  this.x = Math.random()*canvas.width;
Â  Â  this.y = Math.random()*canvas.height;
Â  Â  this.r = Math.random()*2+1;
Â  Â  this.angle = Math.random()*Math.PI*2;
Â  Â  this.orbit = Math.random()*20+6;
Â  Â  this.speed = 0.004 + Math.random()*0.008;
Â  Â  this.color = document.body.classList.contains('dark') ? 'rgba(255,255,255,0.9)' : 'rgba(255,255,255,0.28)';
Â  }
Â  update(){
Â  Â  this.angle += this.speed;
Â  Â  this.x += Math.cos(this.angle)*0.2;
Â  Â  this.y += Math.sin(this.angle)*0.2;
Â  Â  if(mouse.x && mouse.y){
Â  Â  Â  const dx = mouse.x - this.x, dy = mouse.y - this.y;
Â  Â  Â  const dist = Math.sqrt(dx*dx+dy*dy);
Â  Â  Â  if(dist < 120){
Â  Â  Â  Â  this.x += dx*0.01; this.y += dy*0.01;
Â  Â  Â  }
Â  Â  }
Â  Â  if(this.x<0||this.x>canvas.width||this.y<0||this.y>canvas.height) this.reset();
Â  }
Â  draw(){ ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fill(); }
}

function initParticles(){
Â  particlesArray = [];
Â  const count = document.body.classList.contains('dark') ? 150 : 80;
Â  for(let i=0;i<count;i++) particlesArray.push(new BGParticle());
}
initParticles();
function animateParticles(){ ctx.clearRect(0,0,canvas.width,canvas.height); particlesArray.forEach(p=>{ p.update(); p.draw(); }); requestAnimationFrame(animateParticles); }
animateParticles();

/* ===========================
Â  Â three.js 3D åœ£è¯æ ‘ï¼ˆå·¦ä¾§å¡ç‰‡ï¼‰
Â  Â - Canvas åœ¨ #treeCanvasï¼ˆä¸ä¼š append åˆ° bodyï¼‰
Â  Â - ç‚¹å‡»è£…é¥°ä¼šé—ªçƒ
Â  Â - æ»šåŠ¨æ—¶æ ‘å¾®åŠ¨
Â  Â ============================ */
const treeCanvas = document.getElementById('treeCanvas');
const treeCard = document.getElementById('treeCard');

let renderer, scene, camera, controls, treeGroup;
let sphereMesh, cubeMesh, starMesh;
let instanceCount = 450;
let dummy = new THREE.Object3D();
let clock = new THREE.Clock();
let raycaster = new THREE.Raycaster();
let mouseN = new THREE.Vector2();
let ornamentColors = {}; // ä¿å­˜åŸè‰²

function initTree3D(){
Â  const w = treeCard.clientWidth, h = treeCard.clientHeight;
Â  renderer = new THREE.WebGLRenderer({canvas: treeCanvas, alpha:true, antialias:true});
Â  renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
Â  renderer.setSize(w,h);
Â  renderer.setClearColor(0x000000,0);

Â  scene = new THREE.Scene();
Â  camera = new THREE.PerspectiveCamera(50, w/h, 0.1, 2000);
Â  camera.position.set(0,24,80);

Â  // ä¿®å¤: å°† THREE.OrbitControls æ”¹ä¸º OrbitControls
Â  controls = new OrbitControls(camera, renderer.domElement);
Â  controls.enableZoom = false; controls.enablePan = false; controls.enableRotate = false;

Â  // lights
Â  const amb = new THREE.AmbientLight(0xffffff,0.6); scene.add(amb);
Â  const dir = new THREE.DirectionalLight(0xffffff,0.8); dir.position.set(30,80,40); scene.add(dir);

Â  treeGroup = new THREE.Group(); scene.add(treeGroup);

Â  const sphereGeo = new THREE.SphereGeometry(1.6,12,12);
Â  const cubeGeo = new THREE.BoxGeometry(2.2,2.2,2.2);
Â  const goldMat = new THREE.MeshStandardMaterial({color:0xFFD700,metalness:0.8,roughness:0.2});
Â  const greenMat = new THREE.MeshStandardMaterial({color:0x0b6a2d,metalness:0.4,roughness:0.6});

Â  sphereMesh = new THREE.InstancedMesh(sphereGeo, goldMat, instanceCount);
Â  cubeMesh = new THREE.InstancedMesh(cubeGeo, greenMat, instanceCount);
Â  sphereMesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage);
Â  cubeMesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage);

Â  treeGroup.add(sphereMesh); treeGroup.add(cubeMesh);

Â  for(let i=0;i<instanceCount;i++){
Â  Â  const layer = Math.floor(Math.random()*18);
Â  Â  const y = layer*1.6 - 10;
Â  Â  const radius = 1 + (18 - layer)*1.2 + Math.random()*0.6;
Â  Â  const angle = Math.random()*Math.PI*2;
Â  Â  const x = Math.cos(angle)*radius;
Â  Â  const z = Math.sin(angle)*radius*0.8;
Â  Â  dummy.position.set(x,y,z);
Â  Â  dummy.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI);
Â  Â  dummy.scale.setScalar(0.8 + Math.random()*0.9);
Â  Â  dummy.updateMatrix();
Â  Â  if(i%2===0){
Â  Â  Â  sphereMesh.setMatrixAt(i,dummy.matrix);
Â  Â  Â  if(Math.random()>0.6){ sphereMesh.setColorAt(i,new THREE.Color(0xFF2B2B)); ornamentColors['s_'+i]=new THREE.Color(0xFF2B2B); }
Â  Â  Â  else { sphereMesh.setColorAt(i,new THREE.Color(0xFFD700)); ornamentColors['s_'+i]=new THREE.Color(0xFFD700); }
Â  Â  } else {
Â  Â  Â  cubeMesh.setMatrixAt(i,dummy.matrix);
Â  Â  Â  if(Math.random()>0.6){ cubeMesh.setColorAt(i,new THREE.Color(0xFFD700)); ornamentColors['c_'+i]=new THREE.Color(0xFFD700); }
Â  Â  Â  else { cubeMesh.setColorAt(i,new THREE.Color(0x00A86B)); ornamentColors['c_'+i]=new THREE.Color(0x00A86B); }
Â  Â  }
Â  }
Â  sphereMesh.instanceMatrix.needsUpdate=true; cubeMesh.instanceMatrix.needsUpdate=true;
Â  if(sphereMesh.instanceColor) sphereMesh.instanceColor.needsUpdate=true;
Â  if(cubeMesh.instanceColor) cubeMesh.instanceColor.needsUpdate=true;

Â  // star
Â  const starGeo = new THREE.OctahedronGeometry(3.4);
Â  const starMat = new THREE.MeshStandardMaterial({color:0xFFF176,emissive:0xFFEE88,metalness:1,roughness:0.2});
Â  starMesh = new THREE.Mesh(starGeo, starMat); starMesh.position.set(0,20,0);
Â  treeGroup.add(starMesh);

Â  addTreeParticles();

Â  window.addEventListener('resize', ()=>{ const ww=treeCard.clientWidth, hh=treeCard.clientHeight; renderer.setSize(ww,hh); camera.aspect=ww/hh; camera.updateProjectionMatrix(); });

Â  renderer.domElement.addEventListener('pointermove', onPointerMove);
Â  renderer.domElement.addEventListener('pointerdown', onPointerDown);
}

let treeParticles = [];
function addTreeParticles(){
Â  const geo = new THREE.SphereGeometry(0.18,6,6);
Â  for(let i=0;i<60;i++){
Â  Â  const mat = new THREE.MeshStandardMaterial({color:0xffffff,emissive:0xffffff,emissiveIntensity:0.8,transparent:true,opacity:0.9});
Â  Â  const m = new THREE.Mesh(geo, mat);
Â  Â  m.position.set((Math.random()-0.5)*16, Math.random()*24-2, (Math.random()-0.5)*12);
Â  Â  m.userData = { speed: 0.02 + Math.random()*0.02, baseY: m.position.y, phase: Math.random()*Math.PI*2 };
Â  Â  treeParticles.push(m); scene.add(m);
Â  }
}

function onPointerMove(evt){
Â  const rect = renderer.domElement.getBoundingClientRect();
Â  mouseN.x = ((evt.clientX - rect.left) / rect.width) * 2 - 1;
Â  mouseN.y = -((evt.clientY - rect.top) / rect.height) * 2 + 1;
}

function onPointerDown(evt){
Â  const rect = renderer.domElement.getBoundingClientRect();
Â  const x = ((evt.clientX - rect.left)/rect.width)*2 -1;
Â  const y = -((evt.clientY - rect.top)/rect.height)*2 +1;
Â  raycaster.setFromCamera(new THREE.Vector2(x,y), camera);
Â  let intersects = raycaster.intersectObject(sphereMesh);
Â  if(intersects.length>0){
Â  Â  const instId = intersects[0].instanceId;
Â  Â  if(instId !== undefined){ toggleOrnamentColor('s', instId); return; }
Â  }
Â  intersects = raycaster.intersectObject(cubeMesh);
Â  if(intersects.length>0){
Â  Â  const instId = intersects[0].instanceId;
Â  Â  if(instId !== undefined){ toggleOrnamentColor('c', instId); return; }
Â  }
Â  toggleTreeScale();
}

let isTreeScaled = false;
function toggleTreeScale(){
Â  if(!isTreeScaled){ treeCard.style.transform='translateY(-50%) scale(1.12)'; isTreeScaled=true; }
Â  else { treeCard.style.transform='translateY(-50%) scale(1)'; isTreeScaled=false; }
}

function toggleOrnamentColor(type, id){
Â  const key = (type==='s'?'s_':'c_') + id;
Â  const inst = (type==='s')? sphereMesh : cubeMesh;
Â  const orig = ornamentColors[key];
Â  if(!orig) return;
Â  if(!inst.userData) inst.userData = {};
Â  if(inst.userData[id] === 'lit'){
Â  Â  inst.setColorAt(id, orig); inst.userData[id] = null;
Â  } else {
Â  Â  inst.setColorAt(id, new THREE.Color(0xFFFFFF)); inst.userData[id] = 'lit';
Â  Â  setTimeout(()=>{ if(inst.userData && inst.userData[id] === 'lit'){ inst.setColorAt(id, orig); inst.userData[id] = null; if(inst.instanceColor) inst.instanceColor.needsUpdate=true; inst.instanceMatrix.needsUpdate=true; } }, 900);
Â  }
Â  if(inst.instanceColor) inst.instanceColor.needsUpdate=true;
Â  inst.instanceMatrix.needsUpdate=true;
}

function animateTree(){
Â  requestAnimationFrame(animateTree);
Â  const dt = clock.getDelta();
Â  treeGroup.rotation.y += dt * 0.12;
Â  treeParticles.forEach(p=>{ p.position.y = p.userData.baseY + Math.sin(clock.elapsedTime*1.2 + p.userData.phase) * 0.6; });
Â  if(starMesh) starMesh.scale.setScalar(1 + Math.sin(clock.elapsedTime*6)*0.06);
Â  controls.update();
Â  renderer.render(scene, camera);
}

window.addEventListener('scroll', ()=>{
Â  const maxShift = 10;
Â  const scrollFactor = window.scrollY / (document.body.scrollHeight - window.innerHeight);
Â  if(treeGroup) treeGroup.position.y = (scrollFactor - 0.4) * maxShift;
});

/* åˆå§‹åŒ–ä¸‰ç»´æ ‘ */
initTree3D();
animateTree();
</script>

</body>
</html>
